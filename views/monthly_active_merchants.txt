drop view if exists monthly_active_merchants;
CREATE VIEW monthly_active_merchants AS
SELECT TO_CHAR(DATE_TRUNC('month', event_timestamp), 'YYYY-MM') AS month, COUNT(DISTINCT merchant_id) AS monthly_active_merchant_count
FROM __table_name__
-- WHERE status = 'SUCCESS'
WHERE event_timestamp IS NOT NULL
GROUP BY month
HAVING SUM(CASE WHEN status = 'SUCCESS' THEN 1 ELSE 0 END) > 0
ORDER BY month;
